{"version":3,"file":"use-store.showcase.js","sources":["../src/hooks/use-store/use-store.js","../src/hooks/use-store/use-store.showcase.js"],"sourcesContent":["import { useState, useEffect } from \"atomico\";\n\nlet eventTypeUpdate = \"update\";\n\n/**\n * If you use a function you can apply a property\n * calculation strategy using getter\n * @property {Function|Object} initialState - defines the initial state.\n * @example\n * let createInitialState = (store)=>({\n *  fullName(){\n *       return this.fistName + \" \" + this.lastName;\n *  }\n * })\n * @returns {Store}\n */\nexport function createStore(initialState) {\n  let events = {};\n  let chunkUpdate;\n\n  let state = new Proxy(\n    typeof initialState == \"function\"\n      ? initialState(store)\n      : { ...initialState },\n    {\n      set(target, prop, value) {\n        if (target[prop] != value) {\n          // Group updates into a single event\n          if (!chunkUpdate) {\n            chunkUpdate = [\"*\"];\n            queueMicrotask(() => {\n              chunkUpdate.forEach(\n                (prop) =>\n                  events[prop] &&\n                  events[prop].forEach((callback) =>\n                    callback(state, chunkUpdate)\n                  )\n              );\n\n              chunkUpdate = false;\n            });\n          }\n\n          if (chunkUpdate) chunkUpdate.push(prop);\n\n          target[prop] = value;\n        }\n        return true;\n      },\n    }\n  );\n\n  let onUpdate = (prop, callback) => {\n    events[prop] = events[prop] || [];\n\n    if (!events[prop].includes(callback)) events[prop].push(callback);\n\n    return () => events[prop].splice(events[prop].indexOf(callback) >>> 0, 1);\n  };\n\n  let update = (props) => Object.assign(state, props);\n\n  return { onUpdate, update, state };\n}\n\nexport function useStore(store, prop = \"*\") {\n  let [, setState] = useState(0);\n\n  useEffect(() => store.onUpdate(prop, () => setState((state) => state + 1)), [\n    store,\n  ]);\n\n  return store.state;\n}\n\n/**\n * @typedef Store\n * @property {Object} state - Concurrent state\n * @property {(prop:string,callback:Function)=>void} onUpdate - listen for changes associated with a state property\n * @property {(props:Object)=>Object} update - update one or more properties using an object\n */\n","import { h, customElement, Any } from \"atomico\";\r\nimport { createStore, useStore } from \"./use-store\";\r\nexport { render } from \"atomico\";\r\n\r\nlet store = createStore({ count: 0 });\r\n\r\nconst UseStore1 = ({ store }) => {\r\n  let state = useStore(store);\r\n  return (\r\n    <host>\r\n      Component A <button onclick={() => (state.count += 1)}>Increment</button>\r\n      <strong> State : {JSON.stringify(state)}</strong>\r\n    </host>\r\n  );\r\n};\r\n\r\nconst UseStore2 = ({ store }) => {\r\n  let state = useStore(store);\r\n  return (\r\n    <host>\r\n      Component B <button onclick={() => (state.count -= 1)}>Decrement</button>\r\n      <strong> State : {JSON.stringify(state)}</strong>\r\n    </host>\r\n  );\r\n};\r\n\r\nUseStore1.props = UseStore2.props = {\r\n  store: Any,\r\n};\r\n\r\ncustomElement(\"use-store-1\", UseStore1);\r\ncustomElement(\"use-store-2\", UseStore2);\r\n\r\nexport default [\r\n  {\r\n    label: \"useStore\",\r\n    render() {\r\n      store.onUpdate(\"*\", (store) => {\r\n        console.log(store);\r\n      });\r\n      return (\r\n        <div>\r\n          <p>\r\n            The components are synchronized to the store given by the parent\r\n          </p>\r\n          <use-store-1 store={store}></use-store-1>\r\n          <br />\r\n          <use-store-2 store={store}></use-store-2>\r\n        </div>\r\n      );\r\n    },\r\n  },\r\n];\r\n"],"names":["createStore","initialState","events","chunkUpdate","state","Proxy","store","set","target","prop","value","queueMicrotask","forEach","callback","push","onUpdate","includes","splice","indexOf","update","props","Object","assign","useStore","setState","useState","useEffect","count","UseStore1","JSON","stringify","UseStore2","Any","customElement","label","render","console","log"],"mappings":"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"}