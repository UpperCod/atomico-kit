{"version":3,"file":"use-store.showcase.js","sources":["../src/hooks/use-store/use-store.js","../src/hooks/use-store/use-store.showcase.js"],"sourcesContent":["import { useState, useEffect } from \"atomico\";\n\nlet eventTypeUpdate = \"update\";\n\n/**\n * If you use a function you can apply a property\n * calculation strategy using getter\n * @property {Function|Object} initialState - defines the initial state.\n * @example\n * let createInitialState = (store)=>({\n *  fullName(){\n *       return this.fistName + \" \" + this.lastName;\n *  }\n * })\n * @returns {Store}\n */\nexport function createStore(initialState) {\n  let store = new EventTarget();\n\n  let state =\n    typeof initialState == \"function\"\n      ? initialState(store)\n      : { ...initialState };\n\n  let chunkUpdate;\n\n  store.state = new Proxy(state, {\n    set(target, prop, value) {\n      if (target[prop] != value) {\n        // Group updates into a single event\n        if (!chunkUpdate) {\n          chunkUpdate = {};\n          queueMicrotask(() => {\n            let detail = chunkUpdate;\n            chunkUpdate = false;\n            store.dispatchEvent(new CustomEvent(eventTypeUpdate, { detail }));\n          });\n        }\n        if (chunkUpdate) {\n          chunkUpdate[prop] = true;\n        }\n\n        target[prop] = value;\n      }\n      return true;\n    },\n  });\n\n  store.onUpdate = (prop, callback) => {\n    let subscribe = ({ detail }) =>\n      (prop == \"*\" || prop in detail) && callback(store.state);\n\n    store.addEventListener(eventTypeUpdate, subscribe);\n\n    return () => store.removeEventListener(eventTypeUpdate, subscribe);\n  };\n\n  store.update = (props) => Object.assign(store.state, props);\n\n  return store;\n}\n\nexport function useStore(store, prop = \"*\") {\n  let [, setState] = useState(0);\n\n  useEffect(() => store.onUpdate(prop, () => setState((state) => state + 1)), [\n    store,\n  ]);\n  return store.state;\n}\n\n/**\n * @typedef Store\n * @property {Object} state - Concurrent state\n * @property {(prop:string,callback:Function)=>void} onUpdate - listen for changes associated with a state property\n * @property {(props:Object)=>Object} update - update one or more properties using an object\n */\n","import { h, customElement, Any } from \"atomico\";\r\nimport { createStore, useStore } from \"./use-store\";\r\nexport { render } from \"atomico\";\r\n\r\nlet store = createStore({ count: 0 });\r\n\r\nconst UseStore1 = ({ store }) => {\r\n  let state = useStore(store);\r\n  return (\r\n    <host>\r\n      Component A <button onclick={() => (state.count += 1)}>Increment</button>\r\n      <strong> State : {JSON.stringify(state)}</strong>\r\n    </host>\r\n  );\r\n};\r\n\r\nconst UseStore2 = ({ store }) => {\r\n  let state = useStore(store);\r\n  return (\r\n    <host>\r\n      Component B <button onclick={() => (state.count -= 1)}>Decrement</button>\r\n      <strong> State : {JSON.stringify(state)}</strong>\r\n    </host>\r\n  );\r\n};\r\n\r\nUseStore1.props = UseStore2.props = {\r\n  store: Any,\r\n};\r\n\r\ncustomElement(\"use-store-1\", UseStore1);\r\ncustomElement(\"use-store-2\", UseStore2);\r\n\r\nexport default [\r\n  {\r\n    label: \"useStore\",\r\n    render() {\r\n      let removeListener = store.onUpdate((store) => {\r\n        console.log(store);\r\n      });\r\n      return (\r\n        <div>\r\n          <p>\r\n            The components are synchronized to the store given by the parent\r\n          </p>\r\n          <use-store-1 store={store}></use-store-1>\r\n          <br />\r\n          <use-store-2 store={store}></use-store-2>\r\n        </div>\r\n      );\r\n    },\r\n  },\r\n];\r\n"],"names":["eventTypeUpdate","createStore","initialState","store","EventTarget","state","chunkUpdate","Proxy","set","target","prop","value","queueMicrotask","detail","dispatchEvent","CustomEvent","onUpdate","callback","subscribe","addEventListener","removeEventListener","update","props","Object","assign","useStore","setState","useState","useEffect","count","UseStore1","h","JSON","stringify","UseStore2","Any","customElement","label","render","removeListener","console","log"],"mappings":"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"}