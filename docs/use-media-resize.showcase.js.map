{"version":3,"file":"use-media-resize.showcase.js","sources":["../src/hooks/use-media-resize/use-media-resize.js","../src/hooks/use-media-resize/use-media-resize.showcase.js"],"sourcesContent":["import { useEffect, useState } from \"atomico\";\r\n\r\nexport function useMediaResize(value, ref = {}) {\r\n  let sizes = getSizes(value); // The computation process is light in cost vs useMemo\r\n\r\n  let [state, setState] = useState(() => [null, ref]);\r\n\r\n  state[2] = sizes;\r\n\r\n  useEffect(() => {\r\n    let [, ref] = state;\r\n\r\n    if (!ref.listeners) {\r\n      let listeners = [];\r\n      let observer = new ResizeObserver(\r\n        ([\r\n          {\r\n            contentRect: { width },\r\n          },\r\n        ]) => {\r\n          listeners.forEach((fn) => fn(width));\r\n        }\r\n      );\r\n      ref.listeners = listeners;\r\n      observer.observe(ref.current);\r\n    }\r\n\r\n    let listener = (width) => {\r\n      let sizes = state[2];\r\n      if (\r\n        !sizes.cases.some(([value, px]) => {\r\n          if (px >= width) {\r\n            setState(updateState(value));\r\n            return true;\r\n          }\r\n        })\r\n      ) {\r\n        setState(updateState(sizes.default || value));\r\n      }\r\n    };\r\n\r\n    ref.listeners.push(listener);\r\n\r\n    return () => ref.listeners.splice(ref.listeners.indexOf(listener) >>> 0, 1);\r\n  }, []);\r\n  return state;\r\n}\r\n\r\nlet updateState = (nextValue) => (currentState) => {\r\n  let [value, ...state] = currentState;\r\n  return nextValue == value ? currentState : [nextValue, ...state];\r\n};\r\n\r\nfunction getSizes(value) {\r\n  let sizes = { cases: [] };\r\n\r\n  value.split(/ *, */).forEach((value) => {\r\n    let size = value.match(/([^\\s]+) +(\\d+)px/);\r\n    if (size) {\r\n      let [, value, number] = size;\r\n      sizes.cases.push([value, Number(number)]);\r\n    } else {\r\n      sizes.default = value;\r\n    }\r\n  });\r\n\r\n  sizes.cases.sort(([, a], [, b]) => (a > b ? 1 : -1));\r\n\r\n  return sizes;\r\n}\r\n","import { h, customElement } from \"atomico\";\r\nimport { useMediaResize } from \"./use-media-resize\";\r\nexport { render } from \"atomico\";\r\n\r\nconst Example1 = ({ src }) => {\r\n  const [state, ref] = useMediaResize(src);\r\n  return (\r\n    <host ref={ref} shadowDom>\r\n      <style>{`:host{display:block;width:100%}img{width:100%}`}</style>\r\n      <img src={state} />\r\n    </host>\r\n  );\r\n};\r\n\r\nExample1.props = {\r\n  src: String,\r\n};\r\n\r\ncustomElement(\"use-media-resize-example-1\", Example1);\r\n\r\nexport default [\r\n  {\r\n    label: \"Example useMediaResize\",\r\n    render() {\r\n      const url = \"https://via.placeholder.com/\";\r\n      return (\r\n        <host>\r\n          <use-media-resize-example-1\r\n            src={`${url}1080x150, ${url}720x200 720px, ${url}520x300 520px, ${url}320x500 240px`}\r\n          ></use-media-resize-example-1>\r\n        </host>\r\n      );\r\n    },\r\n  },\r\n];\r\n"],"names":["useMediaResize","value","ref","sizes","cases","split","forEach","size","match","number","push","Number","default","sort","a","b","getSizes","state","setState","useState","useEffect","listeners","observer","ResizeObserver","contentRect","width","fn","observe","current","listener","some","px","updateState","splice","indexOf","nextValue","currentState","Example1","src","h","shadowDom","props","String","customElement","label","render","url"],"mappings":"4GAEO,SAASA,EAAeC,EAAOC,EAAM,QACtCC,EAkDN,SAAkBF,OACZE,EAAQ,CAAEC,MAAO,WAErBH,EAAMI,MAAM,SAASC,QAASL,QACxBM,EAAON,EAAMO,MAAM,wBACnBD,EAAM,MACDN,EAAOQ,GAAUF,EACxBJ,EAAMC,MAAMM,KAAK,CAACT,EAAOU,OAAOF,UAEhCN,EAAMS,QAAUX,IAIpBE,EAAMC,MAAMS,KAAK,GAAIC,KAAOC,KAAQD,EAAIC,EAAI,GAAK,GAE1CZ,EAjEKa,CAASf,IAEhBgB,EAAOC,GAAYC,EAAS,IAAM,CAAC,KAAMjB,WAE9Ce,EAAM,GAAKd,EAEXiB,EAAU,UACDlB,GAAOe,MAETf,EAAImB,UAAW,KACdA,EAAY,GACZC,EAAW,IAAIC,eACjB,GAEIC,aAAeC,MAAAA,QAGjBJ,EAAUf,QAASoB,GAAOA,EAAGD,MAGjCvB,EAAImB,UAAYA,EAChBC,EAASK,QAAQzB,EAAI0B,aAGnBC,EAAYJ,QACVtB,EAAQc,EAAM,GAEfd,EAAMC,MAAM0B,KAAK,EAAE7B,EAAO8B,SACrBA,GAAMN,SACRP,EAASc,EAAY/B,KACd,KAIXiB,EAASc,EAAY7B,EAAMS,SAAWX,YAI1CC,EAAImB,UAAUX,KAAKmB,GAEZ,IAAM3B,EAAImB,UAAUY,OAAO/B,EAAImB,UAAUa,QAAQL,KAAc,EAAG,IACxE,IACIZ,EAGT,IAAIe,EAAeG,GAAeC,QAC3BnC,KAAUgB,GAASmB,SACjBD,GAAalC,EAAQmC,EAAe,CAACD,KAAclB,IC9C5D,MAAMoB,EAAW,EAAGC,IAAAA,YACXrB,EAAOf,GAAOF,EAAesC,UAElCC,UAAMrC,IAAKA,EAAKsC,cACdD,eAAS,kDACTA,SAAKD,IAAKrB,MAKhBoB,EAASI,MAAQ,CACfH,IAAKI,QAGPC,EAAc,6BAA8BN,GAE5C,MAAe,CACb,CACEO,MAAO,yBACPC,eACQC,EAAM,sCAEVP,cACEA,gCACED,IAAM,GAAEQ,cAAgBA,mBAAqBA,mBAAqBA"}