{"version":3,"file":"use-state-size.showcase.js","sources":["../src/hooks/use-state-size/use-state-size.js","../src/hooks/use-state-size/use-state-size.showcase.js"],"sourcesContent":["import { useEffect, useState } from \"atomico\";\n// Create a private index on the node,\n// avoiding overloading the browser with multiple instances of ResizeObserver\nconst RESIZE_OBSERVER = Symbol(\"ResizeObserver\");\n// Caches the result of the object returned by getSize\nconst CACHE_SIZES = {};\n\n/**\n * Subscribe to the reference to all size changes\n * @param {Ref} ref\n * @param {(entry:object)=>void} [proxyObserver] - Replace status update with a handler\n * @return {ResizeObserverEntry}\n */\nexport function useResizeObserver(ref, proxyObserver) {\n  let [state, setState] = useState();\n  useEffect(() => {\n    let { current } = ref;\n    // Create or reuse the listener associated with the resizeObserver event\n    if (!current[RESIZE_OBSERVER]) {\n      let handlers = [];\n      let prevent;\n      let observer = new ResizeObserver(([entry]) => {\n        observer.entry = entry;\n        // Skip to next fps to ensure styles resize box before eventLoop\n        if (prevent) return;\n        prevent = true;\n        requestAnimationFrame(() => {\n          handlers.forEach((handler) => handler(entry));\n          prevent = false;\n        });\n      });\n      observer.handlers = handlers;\n\n      observer.observe(current);\n\n      current[RESIZE_OBSERVER] = observer;\n    }\n\n    let { handlers, entry } = current[RESIZE_OBSERVER];\n\n    let handler = (entry) => (proxyObserver || setState)(entry);\n\n    handlers.push(handler);\n\n    if (entry) handler(entry);\n\n    return () => {\n      handlers.splice(handlers.indexOf(handler) >>> 0, 1);\n      if (!handlers.length) {\n        current[RESIZE_OBSERVER].disconnect();\n        delete current[RESIZE_OBSERVER];\n      }\n    };\n  }, [ref]);\n\n  return state;\n}\n/**\n * @param {Ref} ref\n */\nexport function useSize(ref, proxyObserver) {\n  let getState = (resizeObserverEntry) => {\n    if (resizeObserverEntry) {\n      let {\n        contentRect: { width, height },\n      } = resizeObserverEntry;\n      return [width, height];\n    } else {\n      return [];\n    }\n  };\n\n  let nextProxyObserver = proxyObserver\n    ? (resizeObserverEntry) => proxyObserver(getState(resizeObserverEntry))\n    : null;\n\n  let resizeObserverEntry = useResizeObserver(ref, nextProxyObserver);\n\n  return !nextProxyObserver && getState(resizeObserverEntry);\n}\n/**\n *\n * @param {*} value\n * @param {Ref} ref\n */\nexport function useStateSize(value, ref) {\n  let sizes = getSizes(value);\n  let valueIsArray = sizes.w && sizes.h;\n  let [state, setState] = useState(valueIsArray ? [] : null);\n  useSize(ref, ([width, height]) =>\n    setState((currentState) => {\n      let state;\n      let addValue = (value, isDefault) => {\n        if (valueIsArray) {\n          state = state || [];\n          state.push(value);\n        } else {\n          state = value;\n        }\n      };\n\n      if (\n        sizes.w &&\n        !sizes.w.some(([value, w]) => {\n          if (w >= width) {\n            addValue(value);\n            return true;\n          }\n        })\n      ) {\n        addValue(sizes.default, true);\n      }\n\n      if (\n        sizes.h &&\n        !sizes.h.some(([value, h]) => {\n          if (h >= height) {\n            addValue(value);\n            return true;\n          }\n        })\n      ) {\n        addValue(sizes.default, true);\n      }\n      if (\n        valueIsArray &&\n        !state.every((value, index) => currentState[index] == value)\n      ) {\n        return state;\n      } else {\n        return state != currentState ? state : currentState;\n      }\n    })\n  );\n  return state;\n}\n\nfunction getSizes(value) {\n  if (CACHE_SIZES[value]) return CACHE_SIZES[value];\n\n  let sizes = {};\n\n  value.split(/ *, */).forEach((value) => {\n    let size = value.match(/([^\\s]+)\\s+(\\d+)(w|h)/);\n    if (size) {\n      let [, value, number, type] = size;\n      number = Number(number);\n      sizes[type] = sizes[type] || [];\n      sizes[type].push([value, number]);\n    } else {\n      sizes.default = value;\n    }\n  });\n\n  let sort = ([, a], [, b]) => (a > b ? 1 : -1);\n\n  for (let key in sizes) {\n    if (Array.isArray(sizes[key])) sizes[key].sort(sort);\n  }\n\n  return (CACHE_SIZES[value] = sizes);\n}\n\n/**\n * @typedef {{borderBoxSize: Object, contentBoxSize: Object, contentRect: DOMRectReadOnly, target: Element}} ResizeObserverEntry\n */\n\n/**\n * @typedef {{current?: Ref}} Ref\n */\n","import { h, customElement, useRef } from \"atomico\";\r\nimport { useStateSize } from \"./use-state-size\";\r\nexport { render } from \"atomico\";\r\n\r\nconst Example1 = ({ src }) => {\r\n  let ref = useRef();\r\n\r\n  let state = useStateSize(\"1fr 1fr 1fr, 1fr 1fr 720w, 1fr 520w\", ref);\r\n  return (\r\n    <host shadowDom ref={ref}>\r\n      <style>{`:host{display:block;width:100%}img{width:100%}`}</style>\r\n      <h1>{state}</h1>\r\n    </host>\r\n  );\r\n};\r\n\r\ncustomElement(\"use-media-resize-example-1\", Example1);\r\n\r\nexport default [\r\n  {\r\n    label: \"Example useMediaResize\",\r\n    render() {\r\n      return (\r\n        <host>\r\n          <use-media-resize-example-1></use-media-resize-example-1>\r\n        </host>\r\n      );\r\n    },\r\n  },\r\n];\r\n"],"names":["RESIZE_OBSERVER","Symbol","CACHE_SIZES","useResizeObserver","ref","proxyObserver","state","setState","useState","useEffect","current","handlers","prevent","observer","ResizeObserver","entry","requestAnimationFrame","forEach","handler","observe","push","splice","indexOf","length","disconnect","useSize","getState","resizeObserverEntry","contentRect","width","height","nextProxyObserver","useStateSize","value","sizes","getSizes","valueIsArray","w","h","currentState","addValue","isDefault","some","default","every","index","split","size","match","number","type","Number","sort","a","b","key","Array","isArray","Example1","src","useRef","customElement","label","render"],"mappings":"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"}