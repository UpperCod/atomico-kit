{"version":3,"file":"use-state-size.showcase.js","sources":["../src/hooks/use-state-size/use-state-size.js","../src/hooks/use-state-size/use-state-size.showcase.js"],"sourcesContent":["import { useEffect, useState } from \"atomico\";\n\nconst RESIZE_OBSERVER = [];\nconst CACHE_SIZES = {};\n\n/**\n * @param {Ref} ref\n * @return {ResizeObserverEntry}\n */\nexport function useResizeObserver(ref, proxyObserver) {\n  let [state, setState] = useState();\n  useEffect(() => {\n    let { current } = ref;\n    // Create or reuse the listener associated with the resizeObserver event\n    if (!current[RESIZE_OBSERVER]) {\n      let handlers = [];\n      let observer = new ResizeObserver(([entry]) => {\n        observer.entry = entry;\n        handlers.forEach((handler) => handler(entry));\n      });\n      observer.handlers = handlers;\n\n      observer.observe(current);\n\n      current[RESIZE_OBSERVER] = observer;\n    }\n\n    let { handlers, entry } = current[RESIZE_OBSERVER];\n\n    let handler = (entry) => (proxyObserver || setState)(entry);\n\n    handlers.push(handler);\n\n    if (entry) handler(entry);\n\n    return () => {\n      handlers.splice(handlers.indexOf(handler) >>> 0, 1);\n      if (!handlers.length) {\n        current[RESIZE_OBSERVER].disconnect();\n        delete current[RESIZE_OBSERVER];\n      }\n    };\n  }, [ref]);\n\n  return state;\n}\n/**\n * @param {Ref} ref\n */\nexport function useSize(ref, proxyObserver) {\n  let getState = (resizeObserverEntry) => {\n    if (resizeObserverEntry) {\n      let {\n        contentRect: { width, height },\n      } = resizeObserverEntry;\n      return [width, height];\n    } else {\n      return [];\n    }\n  };\n\n  let nextProxyObserver = proxyObserver\n    ? (resizeObserverEntry) => proxyObserver(getState(resizeObserverEntry))\n    : null;\n\n  let resizeObserverEntry = useResizeObserver(ref, nextProxyObserver);\n\n  return !nextProxyObserver && getState(resizeObserverEntry);\n}\n/**\n *\n * @param {*} value\n * @param {Ref} ref\n */\nexport function useStateSize(value, ref) {\n  let sizes = getSizes(value);\n  let valueIsArray = sizes.w && sizes.h;\n  let [state, setState] = useState(valueIsArray ? [] : null);\n\n  useSize(ref, ([width, height]) =>\n    setState((currentState) => {\n      let state;\n      let addValue = (value, isDefault) => {\n        if (valueIsArray) {\n          state = state || [];\n          state.push(value);\n        } else {\n          state = value;\n        }\n      };\n\n      if (\n        sizes.w &&\n        !sizes.w.some(([value, w]) => {\n          if (w >= width) {\n            addValue(value);\n            return true;\n          }\n        })\n      ) {\n        addValue(sizes.default, true);\n      }\n\n      if (\n        sizes.h &&\n        !sizes.h.some(([value, h]) => {\n          if (h >= height) {\n            addValue(value);\n            return true;\n          }\n        })\n      ) {\n        addValue(sizes.default, true);\n      }\n      if (\n        valueIsArray &&\n        !state.every((value, index) => currentState[index] == value)\n      ) {\n        return state;\n      } else {\n        return state != currentState ? state : currentState;\n      }\n    })\n  );\n  return state;\n}\n\nfunction getSizes(value) {\n  if (CACHE_SIZES[value]) return CACHE_SIZES[value];\n\n  let sizes = {};\n\n  value.split(/ *, */).forEach((value) => {\n    let size = value.match(/([^\\s]+)\\s+(\\d+)(w|h)/);\n    if (size) {\n      let [, value, number, type] = size;\n      number = Number(number);\n      sizes[type] = sizes[type] || [];\n      sizes[type].push([value, number]);\n    } else {\n      sizes.default = value;\n    }\n  });\n\n  let sort = ([, a], [, b]) => (a > b ? 1 : -1);\n\n  for (let key in sizes) {\n    if (Array.isArray(sizes[key])) sizes[key].sort(sort);\n  }\n\n  return (CACHE_SIZES[value] = sizes);\n}\n\n/**\n * @typedef {{borderBoxSize: Object, contentBoxSize: Object, contentRect: DOMRectReadOnly, target: Element}} ResizeObserverEntry\n */\n\n/**\n * @typedef {{current?: Ref}} Ref\n */\n","import { h, customElement, useRef } from \"atomico\";\r\nimport { useStateSize } from \"./use-state-size\";\r\nexport { render } from \"atomico\";\r\n\r\nconst Example1 = ({ src }) => {\r\n  let ref = useRef();\r\n\r\n  let state = useStateSize(\"1fr 1fr 1fr, 1fr 1fr 720w, 1fr 520w\", ref);\r\n  return (\r\n    <host shadowDom ref={ref}>\r\n      <style>{`:host{display:block;width:100%}img{width:100%}`}</style>\r\n      <h1>{state}</h1>\r\n    </host>\r\n  );\r\n};\r\n\r\ncustomElement(\"use-media-resize-example-1\", Example1);\r\n\r\nexport default [\r\n  {\r\n    label: \"Example useMediaResize\",\r\n    render() {\r\n      return (\r\n        <host>\r\n          <use-media-resize-example-1></use-media-resize-example-1>\r\n        </host>\r\n      );\r\n    },\r\n  },\r\n];\r\n"],"names":["RESIZE_OBSERVER","CACHE_SIZES","useResizeObserver","ref","proxyObserver","state","setState","useState","useEffect","current","handlers","observer","ResizeObserver","entry","forEach","handler","observe","push","splice","indexOf","length","disconnect","useSize","getState","resizeObserverEntry","contentRect","width","height","nextProxyObserver","useStateSize","value","sizes","getSizes","valueIsArray","w","h","currentState","addValue","isDefault","some","default","every","index","split","size","match","number","type","Number","sort","a","b","key","Array","isArray","Example1","src","useRef","customElement","label","render"],"mappings":"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"}